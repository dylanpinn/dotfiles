""" vimrc
"
" Author: Dylan Pinn
" Repo: https://github.com/dylanpinn/dotfiles

""" Plugins

" install vim-plug
if empty(glob('~/.vim/autoload/plug.vim'))
  silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs
    \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  autocmd VimEnter * PlugInstall --sync | source $MYVIMRC
endif

call plug#begin('~/.vim/plugged')
" General
Plug 'tpope/vim-surround'                 " quoting/paraenthese easier
Plug 'wakatime/vim-wakatime'              " Wakatime
Plug 'editorconfig/editorconfig-vim'      " EditorConfig
Plug 'tpope/vim-commentary'               " Comment stuff out
Plug 'tpope/vim-dispatch'                 " Async tasks
Plug 'tpope/vim-fugitive'                 " Git manager
Plug 'tpope/vim-vinegar'                  " Improve netrw
Plug 'qpkorr/vim-bufkill'                 " rm bufs w/out closing splits
" Plug 'embear/vim-localvimrc'              " local vimrc
Plug 'ajh17/VimCompletesMe'               " better auto-complete
Plug 'junegunn/fzf.vim'                   " Bindings for FZF

" Language Support
Plug 'sheerun/vim-polyglot'               " improved language support
" Plug 'tpope/vim-rails'                    " improve editing rails apps
" Plug 'godlygeek/tabular'                  " Improved table support
Plug 'plasticboy/vim-markdown'            " Improved markdown support
" Plug 'janko/vim-test'                     " Test runner

" Terminal/Tmux
Plug 'wincent/terminus'                   " improved terminal
Plug 'tmux-plugins/vim-tmux-focus-events' " Fix vim focus events inside tmux

" Tags
Plug 'ludovicchabant/vim-gutentags'       " auto-generate tags file
" Plug 'tomtom/ttags_vim'                   " tag explorer
" Plug 'tomtom/tlib_vim'                    " dep for ttags_vim

" Theme
Plug 'drewtempelmeyer/palenight.vim'
call plug#end()

""" Bindings

" easier split navigations
nnoremap <C-J> <C-W><C-J>
nnoremap <C-K> <C-W><C-K>
nnoremap <C-L> <C-W><C-L>
nnoremap <C-H> <C-W><C-H>

" Quickly switch between last used buffers
nnoremap <leader><leader> <c-^>

" move vertically by visual line
nnoremap j gj
nnoremap k gk

" getting around

"" File finder
nmap <Leader>f :GFiles<CR>
nmap <Leader>F :Files<CR>

"" Buffer finder
nmap <Leader>b :Buffers<CR>
nmap <Leader>h :History<CR>

"" Tag finder
" nmap <Leader>t :BTags<CR>
" nmap <Leader>T :Tags<CR>

"" Project finder
nmap <Leader>a :Ag<Space>

" Run make
nnoremap <leader>m :Make %<cr>

""" UI Config
set showcmd             " show command in bottom bar
set lazyredraw          " redraw only when we need to.
set showmatch           " highlight matching [{()}]

""" Searching

" Improve the built in grep
if executable('ag')
  set grepprg=ag\ --nogroup\ --nocolor\ --ignore-case\ --column
  set grepformat=%f:%l:%c:%m,%f:%l:%m
endif

" " vim-test configuration

" " Key mappings
" nmap <silent> t<C-n> :TestNearest<CR>
" nmap <silent> t<C-f> :TestFile<CR>
" nmap <silent> t<C-s> :TestSuite<CR>
" nmap <silent> t<C-l> :TestLast<CR>
" nmap <silent> t<C-g> :TestVisit<CR>

" " make test commands execute using dispatch.vim
" let test#strategy = "dispatch"
""" Colours
if (has("nvim"))
  let $NVIM_TUI_ENABLE_TRUE_COLOR=1
endif

" Italics for my favorite color scheme
let g:palenight_terminal_italics=1

set background=dark
colorscheme palenight

" """ TTags mappings

" " Show available tags
" noremap <Leader>g. :TTags<cr>

" " Show current buffer's tags
" noremap <Leader>g% :call ttags#List(0, "*", "", ".")<cr>

" " Show tags matching the word under cursor
" noremap <Leader>g# :call ttags#List(0, "*", tlib#rx#Escape(expand("<cword>")))<cr>

" " Show tags with a prefix matching the word under cursor
" noremap <Leader>g* :call ttags#List(0, "*", tlib#rx#Escape(expand("<cword>")) .".*")<cr>

" " Show tags matching the word under cursor (search also in |g:tlib_tags_extra|)
" noremap <Leader>g? :call ttags#List(1, "*", tlib#rx#Escape(expand("<cword>")))<cr>

" " Show tags of a certain category
" for c in split('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ', '\zs')
"   exec 'noremap <Leader>g'. c .' :TTags '. c .'<cr>'
" endfor

" Automatically open, but do not go to (if there are errors) the quickfix /
" location list window, or close it when is has become empty.
"
" Note: Must allow nesting of autocmds to enable any customizations for quickfix
" buffers.
" Note: Normally, :cwindow jumps to the quickfix window if the command opens it
" (but not if it's already open). However, as part of the autocmd, this doesn't
" seem to happen.
autocmd QuickFixCmdPost [^l]* nested cwindow
autocmd QuickFixCmdPost    l* nested lwindow

" Markdown options

" This line prevents polyglot from loading markdown packages.
let g:polyglot_disabled = ['md', 'markdown']

" This line configures markdown-vim to highlight code blocks for given languages.
let g:markdown_fenced_languages = ['html', 'css', 'php', 'js']

" Enable Markdown math
let g:vim_markdown_math = 1

let g:vim_markdown_frontmatter = 1
let g:vim_markdown_toml_frontmatter = 1
let g:vim_markdown_strikethrough = 2
let g:vim_markdown_folding_disabled = 1

" Softwrap
command! -nargs=* Wrap set wrap linebreak nolist

" Toggle spell checking on and off with `,s`
nmap <silent> <leader>s :set spell!<CR>

" Set region to Australian English
set spelllang=en_au

if has("autocmd")
  " Restore cursor position
  autocmd BufReadPost *
    \ if line("'\"") > 1 && line("'\"") <= line("$") |
    \   exe "normal! g`\"" |
    \ endif
endif

" Source the vimrc file after saving it
if has("autocmd")
  autocmd bufwritepost .vimrc source $MYVIMRC
  autocmd bufwritepost vimrc source $MYVIMRC
endif

" Edit vimrc in a new tab.
nmap <leader>v :tabedit $MYVIMRC<CR>

" FZF - Add to path if installed using Homebrew
set rtp+=/usr/local/opt/fzf

" # vim: set syntax=vim:
